import React from 'react';
import { Button } from '@/components/ui/button';
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow, TableCaption } from '@/components/ui/table';
import { Dialog, DialogTrigger, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter, DialogClose } from '@/components/ui/dialog';
import { motion, AnimatePresence } from 'framer-motion';
import { Edit3, Trash2, User } from 'lucide-react';
import { Avatar, AvatarImage, AvatarFallback } from '@/components/ui/avatar.jsx';

const ChefAgenceTable = ({ chefs, onEdit, onDelete, isLoading }) => {
  if (!chefs || chefs.length === 0) {
    return <p className="text-center text-muted-foreground mt-4">Aucun chef d'agence trouvé.</p>;
  }

  return (
    <>
      <Table>
        <TableCaption>Liste des chefs d'agence.</TableCaption>
        <TableHeader>
          <TableRow>
            <TableHead className="w-10">Photo</TableHead>
            <TableHead>Matricule</TableHead>
            <TableHead>Nom</TableHead>
            <TableHead>Prénom</TableHead>
            <TableHead>Agence en Charge</TableHead>
            <TableHead>Code PDV</TableHead>
            <TableHead className="text-right">Actions</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          <AnimatePresence>
            {chefs.map((chef, index) => (
              <motion.tr 
                key={chef.id}
                initial={{ opacity: 0, y: -10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, x: -30 }}
                transition={{ delay: index * 0.05 }}
                className="hover:bg-muted/50 dark:hover:bg-muted/20"
              >
                <TableCell>
                  <Avatar className="h-10 w-10 border">
                    {chef.photo_url ? (
                      <AvatarImage src={chef.photo_url} alt={`${chef.prenom} ${chef.nom}`} />
                    ) : null}
                    <AvatarFallback className="bg-primary/10">
                      {chef.prenom?.charAt(0)}{chef.nom?.charAt(0)}
                    </AvatarFallback>
                  </Avatar>
                </TableCell>
                <TableCell className="font-medium">{chef.matricule}</TableCell>
                <TableCell>{chef.nom}</TableCell>
                <TableCell>{chef.prenom}</TableCell>
                <TableCell>{chef.agenceEnCharge || 'N/A'}</TableCell>
                <TableCell>{chef.codePDV || 'N/A'}</TableCell>
                <TableCell className="text-right space-x-1">
                  <Button variant="ghost" size="icon" onClick={() => onEdit(chef)} disabled={isLoading}>
                    <Edit3 className="h-4 w-4 text-blue-500" />
                  </Button>
                  <Dialog>
                    <DialogTrigger asChild>
                      <Button variant="ghost" size="icon" disabled={isLoading}>
                        <Trash2 className="h-4 w-4 text-red-500" />
                      </Button>
                    </DialogTrigger>
                    <DialogContent>
                      <DialogHeader>
                        <DialogTitle>Confirmer la suppression</DialogTitle>
                        <DialogDescription>
                          Êtes-vous sûr de vouloir supprimer ce chef d'agence ({chef.prenom} {chef.nom}) ? Cette action est irréversible et supprimera les plannings associés.
                        </DialogDescription>
                      </DialogHeader>
                      <DialogFooter>
                        <DialogClose asChild>
                          <Button variant="outline" disabled={isLoading}>Annuler</Button>
                        </DialogClose>
                        <Button variant="destructive" onClick={() => onDelete(chef.id)} disabled={isLoading}>
                           {isLoading ? 'Suppression...' : 'Supprimer'}
                        </Button>
                      </DialogFooter>
                    </DialogContent>
                  </Dialog>
                </TableCell>
              </motion.tr>
            ))}
          </AnimatePresence>
        </TableBody>
      </Table>
    </>
  );
};

export default ChefAgenceTable;
